!function(){"use strict";function e(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function n(n,t){if(n){if("string"===typeof n)return e(n,t);var r=Object.prototype.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(n):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(n,t):void 0}}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,i=[],s=!0,a=!1;try{for(t=t.call(e);!(s=(r=t.next()).done)&&(i.push(r.value),!n||i.length!==n);s=!0);}catch(u){a=!0,o=u}finally{try{s||null==t.return||t.return()}finally{if(a)throw o}}return i}}(e,t)||n(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var r={subdivisionRows:0,subdivisionColumns:0,columnsPerSubdivision:0,rowsPerSubdivision:0,minVertexDepth:0,maxVertexDepth:0,baseVertexDepth:0,vertexDepthRange:0,waveDampingFactor:.99,sourcePositions:[],resultPositions:[],resetRequested:!1,pendingPointerEvents:new Map},o={getZ:function(e,n){return e[3*n+2]},setZ:function(e,n,t){e[3*n+2]=t},getScaledColor:function(e,n){return(o.getZ(e,n)-r.minVertexDepth)/r.vertexDepthRange},handleInit:function(e){r.subdivisionRows=e.subdivisionRows,r.subdivisionColumns=e.subdivisionColumns,r.columnsPerSubdivision=e.columnsPerSubdivision,r.rowsPerSubdivision=e.rowsPerSubdivision,r.minVertexDepth=e.minVertexDepth,r.maxVertexDepth=e.maxVertexDepth,r.baseVertexDepth=e.minVertexDepth+(e.maxVertexDepth-e.minVertexDepth)/2,r.vertexDepthRange=e.maxVertexDepth-e.minVertexDepth,r.waveDampingFactor=e.waveDampingFactor,r.resetRequested=!1;for(var n=0;n<r.subdivisionRows;n++){r.sourcePositions[n]=[],r.resultPositions[n]=[];for(var t=0;t<r.subdivisionColumns;t++)r.sourcePositions[n][t]=new Float32Array(e.vertexPositionTemplate),r.resultPositions[n][t]=new Float32Array(e.vertexPositionTemplate)}r.pendingPointerEvents.clear()},handleReset:function(){r.resetRequested=!0,r.pendingPointerEvents.clear()},handlePointer:function(e){if(!r.resetRequested){var n="".concat(e.rowIndex,"_").concat(e.columnIndex,"_").concat(e.vertexIndex);r.pendingPointerEvents.set(n,{rowIndex:e.rowIndex,columnIndex:e.columnIndex,vertexIndex:e.vertexIndex})}}};o.handleReady=function(){var e=r.rowsPerSubdivision*r.columnsPerSubdivision,i=o.getZ;if(!1===r.resetRequested){var s,a=function(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=n(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw s}}}}(r.pendingPointerEvents);try{for(a.s();!(s=a.n()).done;){var u=t(s.value,2)[1],l=r.sourcePositions[u.rowIndex][u.columnIndex],d=r.resultPositions[u.rowIndex][u.columnIndex];o.setZ(l,u.vertexIndex,r.minVertexDepth),o.setZ(d,u.vertexIndex,r.maxVertexDepth)}}catch(E){a.e(E)}finally{a.f()}}r.pendingPointerEvents.clear();for(var c=0;c<r.subdivisionRows;c++)for(var v=0;v<r.subdivisionColumns;v++)for(var f=r.sourcePositions[c][v],m=r.resultPositions[c][v],x=0;x<e;x++)if(r.resetRequested)o.setZ(f,x,r.baseVertexDepth),o.setZ(m,x,r.baseVertexDepth);else{var b=x%r.rowsPerSubdivision,p=Math.floor(x/r.columnsPerSubdivision),h=0;if(p>0)h+=i(f,x-r.columnsPerSubdivision);else if(c>0){h+=i(r.sourcePositions[c-1][v],x+r.columnsPerSubdivision*(r.rowsPerSubdivision-1))}if(p<r.rowsPerSubdivision-1)h+=i(f,x+r.columnsPerSubdivision);else if(c<r.subdivisionRows-1){h+=i(r.sourcePositions[c+1][v],x%r.columnsPerSubdivision)}if(b>0)h+=i(f,x-1);else if(v>0){h+=i(r.sourcePositions[c][v-1],x+(r.columnsPerSubdivision-1))}if(b<r.columnsPerSubdivision-1)h+=i(f,x+1);else if(v<r.subdivisionColumns-1){h+=i(r.sourcePositions[c][v+1],x-(r.columnsPerSubdivision-1))}var P=Math.min(r.maxVertexDepth,Math.max(r.minVertexDepth,h/2-i(m,x)));P*=r.waveDampingFactor,o.setZ(m,x,P)}for(var y=[],w={type:"result",vertexPositions:[],vertexColors:[]},g=0;g<r.subdivisionRows;g++){w.vertexPositions[g]=[],w.vertexColors[g]=[];for(var S=0;S<r.subdivisionColumns;S++){var D=r.resultPositions[g][S],I=new Float32Array(D);w.vertexPositions[g][S]=I,y.push(I.buffer);for(var R=new Float32Array(3*e),V=0,C=0;V<e;V++,C+=3){var A=o.getScaledColor(I,V);R[C]=A,R[C+1]=A,R[C+2]=1}w.vertexColors[g][S]=R,y.push(R.buffer);var Z=D;r.resultPositions[g][S]=r.sourcePositions[g][S],r.sourcePositions[g][S]=Z}}r.resetRequested=!1,postMessage(w,y)},onmessage=function(e){switch(e.data.type){case"init":o.handleInit(e.data);break;case"reset":o.handleReset();break;case"pointer":o.handlePointer(e.data);break;case"ready":o.handleReady();break;default:console.warn("unrecognized message type: ".concat(e.data.type),e)}}}();
//# sourceMappingURL=317.36a39126.chunk.js.map